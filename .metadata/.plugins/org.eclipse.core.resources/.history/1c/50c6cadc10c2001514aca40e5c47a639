package OpenEJA.DAL;

import java.sql.*;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map.Entry;

public abstract class DBAdapter implements IDBAdapter {

	String dbUrl = "jdbc:mysql://localhost:3306/javadb";
	String user = "javadb";
	String pass = "Password123";

	Connection myConn;
	Statement myStmt;

	@Override
	public void connect() {
		try {

			myConn = DriverManager.getConnection(dbUrl, user, pass);

		} catch (SQLException e) {

			e.printStackTrace();
		}

	}

	@Override
	public void insert(String table, HashMap<?, ?> data) {
		try {
			StringBuffer fieldNames = new StringBuffer();
			StringBuffer fieldValues = new StringBuffer();
			Iterator<?> iterator = data.entrySet().iterator();
			while (iterator.hasNext()) {
				Entry<?, ?> entry = (Entry<?, ?>) iterator.next();
				fieldNames.append(entry.getKey());
				fieldValues.append("'").append(entry.getValue()).append("'");
				if (iterator.hasNext()) {
					fieldNames.append(",");
					fieldValues.append(",");
				}
			}
			StringBuilder sql = new StringBuilder();
			sql.append("INSERT INTO ").append(table).append("( ").append(fieldNames.toString()).append(" )");
			sql.append("VALUES (").append(fieldValues.toString()).append(" )");
			System.out.println(sql.toString());
			myStmt = myConn.createStatement();

			myStmt.executeUpdate(sql.toString());
		} catch (SQLException e) {

			e.printStackTrace();
		}

	}

	@Override
	public void update(String table, HashMap<?, ?> data, HashMap<?, ?> where) {
		try {
			StringBuffer fieldDetails = new StringBuffer();
			Iterator<?> dataIterator = data.entrySet().iterator();
			while (dataIterator.hasNext()) {
				Entry<?, ?> entry = (Entry<?, ?>) dataIterator.next();
				fieldDetails.append(entry.getKey()).append("=").append("'").append(entry.getValue()).append("'");

				if (dataIterator.hasNext()) {
					fieldDetails.append(",");

				}
			}
			StringBuffer whereDetails = new StringBuffer();
			Iterator<?> whereIterator = where.entrySet().iterator();
			while (whereIterator.hasNext()) {
				Entry<?, ?> entry = (Entry<?, ?>) whereIterator.next();
				whereDetails.append(entry.getKey()).append("=").append("'").append(entry.getValue()).append("'");

				if (whereIterator.hasNext()) {
					whereDetails.append(",");

				}
			}
			StringBuilder sql = new StringBuilder();
			sql.append("UPDATE ").append(table).append(" SET ").append(fieldDetails.toString());
			sql.append(" WHERE ").append(whereDetails.toString());

			System.out.println(sql.toString());
			myStmt = myConn.createStatement();
			myStmt.executeUpdate(sql.toString());
		} catch (SQLException e) {

			e.printStackTrace();
		}

	}

	@Override
	public void delete() {
		try {
			myStmt = myConn.createStatement();
			// sql = "delete from employees where id='1' ";
			// myStmt.executeUpdate(sql);
		} catch (SQLException e) {

			e.printStackTrace();
		}

	}

	@Override
	public void retrieve() {
		try {
			myStmt = myConn.createStatement();
			ResultSet myRs = myStmt.executeQuery("select * from employees");
			while (myRs.next()) {
				System.out.println(myRs.getString("id") + ", " + myRs.getString("last_name") + ", "
						+ myRs.getString("first_name") + ", " + myRs.getString("email"));
			}
		} catch (SQLException e) {

			e.printStackTrace();
		}

	}

}
